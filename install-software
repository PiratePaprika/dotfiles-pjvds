#!/bin/bash

##
#  Regular packages
##
set -e

echo "Updating apt-get list..."
sudo apt-get update -y 1>/dev/null
echo "Done"

sudo apt-get install libssl-dev build-essential \
                     libxslt-dev libxml2-dev -y

##
#  MacBook Fan Control Daemon
#
#  This software controls the fan in the MacBook
##
if ! hash mbpfan 2>/dev/null ; then
    echo "Installing MacBook Fan Control Daemon"
    sudo apt-get install build-essential -y -qq
    git clone git@github.com:pjvds/Fan-Control-Daemon.git $HOME/.Fan-Control-Daemon
    cd $HOME/.Fan-Control-Daemon
    make
    sudo make install
    sudo cp mbpfan.upstart /etc/init/mbpfan.conf
    sudo start mbpfan
else
    echo "Skipping MacBook Fan Control Deamon... mbpfan already exists"
fi

##
#  rbenv and ruby-build
##
if ! hash rbenv 2>/dev/null ; then
    echo "Installing rbenv"
    git clone https://github.com/sstephenson/rbenv.git $HOME/.rbenv
    git clone https://github.com/sstephenson/ruby-build.git $HOME/.rbenv/plugins/ruby-build
else
    echo "Skipping rbenv... rbenv already exists"
fi

##
#  The Ultimate Vim Distribution
##
if [ ! -d "$HOME/.spf13-vim-3" ] ; then
    echo "Installing The Ultimate Vim Distribution"
    sudo apt-get install vim -y -qq
    curl http://j.mp/spf13-vim3 -L -o - | sh
fi

##
#  Autojump
##
if ! hash autojump 2>/dev/null ; then
    echo "Installing autojump"
    sudo apt-get install autojump -y -qq
fi

##
#  Go 1.1.2
##
if ! hash go 2>/dev/null ; then
    echo "Installing Google's Go"
    wget https://go.googlecode.com/files/go1.1.2.linux-amd64.tar.gz
    sudo tar -C /usr/local -xzf go1.1.2.linux-amd64.tar.gz
    rm go1.1.2.linux-amd64.tar.gz

    # Create workspace directories
    mkdir -p "$HOME/go/"{src,pkg,bin}
fi

##
#  HipChat
##
if ! hash hipchat 2>/dev/null ; then
    echo "Installing hipchat"
    echo "deb http://downloads.hipchat.com/linux/apt stable main" | \
        sudo tee "/etc/apt/sources.list.d/atlassian-hipchat.list"

    wget -O - https://www.hipchat.com/keys/hipchat-linux.key | \
        sudo apt-key add -
    sudo apt-get update -y -qq
    sudo apt-get install hipchat -y -qq
fi

##
#  Docker
##
if ! hash docker 2>/dev/null ; then
    echo "Install docker"

    # Enable AUFS filesystem support
    sudo apt-get install linux-image-extra-`uname -r` -y -qq
    sudo sh -c "curl https://get.docker.io/gpg | apt-key add -"
    sudo sh -c "echo deb http://get.docker.io/ubuntu docker main > /etc/apt/sources.list.d/docker.list"
    sudo apt-get update -y -qq
    sudo apt-get install lxc-docker -y -qq
fi

##
#  SimpleScreenRecorder
#  http://www.maartenbaert.be/simplescreenrecorder/#download
##
if ! hash simplescreenrecorder 2>/dev/null ; then
    echo "Install SimpleScreenRecorder"
    sudo add-apt-repository ppa:maarten-baert/simplescreenrecorder
    sudo apt-get update -q
    sudo apt-get install simplescreenrecorder -y -q
fi

##
#  git
##
if ! hash git 2>/dev/null ; then
    echo "Installing git"
    sudo apt-get install git -y
fi


##
#  Bazaar
##
if ! hash bzr 2>/dev/null ; then
    echo "Installing bzr"
    sudo apt-get install bzr -y
fi


##
#  Mercurial (hg)
##
if ! hash hg 2>/dev/null ; then
    echo "Installing mercurial"
    sudo apt-get install mercurial -y
fi

##
#  tig
##
if ! hash tig 2>/dev/null ; then
    echo "Installing tig"
    sudo apt-get install tig -y
fi

##
#  Sublime Text 3
##
if ! hash subl 2>/dev/null ; then
    echo "Installing Sublime Text"
    sudo add-apt-repository ppa:webupd8team/sublime-text-3
    sudo apt-get update
    sudo apt-get install sublime-text-installer
fi

##
#  Google's DART
##
if ! hash dart 2>/dev/null ; then
    echo "Installing Dart"
    wget -O - "https://storage.googleapis.com/dart-editor-archive-integration/latest/dartsdk-linux-64.tar.gz" | \
        tar zvxf -
    mv dart-sdk $HOME/
fi


##
#  Python tools
##
if ! hash pip 2>/dev/null ; then
    echo "Installing python tools"
    sudo apt-get install python-setuptools -y
    sudo easy_install pip
fi

##
#  Wercker CLI
##
if ! hash wercker 2>/dev/null ; then
    echo "Installing wercker cli"
    sudo apt-get install python-dev -y
    sudo pip install wercker
fi

##
#  Polly - a multi column twitter client
##
if ! hash polly 2>/dev/null ; then
    echo "Installing Polly"
    sudo add-apt-repository ppa:conscioususer/polly-unstable
    sudo apt-get update
    sudo apt-get install polly
fi

##
# IRSSI irc client
##
if ! hash irssi 2>/dev/null ; then
    echo "Installing IRSSI"
    sudo apt-get install irssi
fi

##
# Virtual Box
##
if ! hash virtualbox 2>/dev/null ; then
    echo "Installing VirtualBox"
    sudo apt-get install virtualbox -y
fi

##
# Vagrant
##
if ! hash vagrant 2>/dev/null ; then
    echo "Installing vagrant"
    wget "http://files.vagrantup.com/packages/a40522f5fabccb9ddabad03d836e120ff5d14093/vagrant_1.3.5_x86_64.deb"
    sudo dpkg -i vagrant_1.3.5_x86_64.deb
    rm vagrant_1.3.5_x86_64.deb

    echo "vagrant version: $(vagrant --version)"
    echo "Done"
fi

##
# FileZilla
##
if ! hash filezilla 2>/dev/null ; then
    echo "Installing filezilla"
    sudo apt-get install filezilla
fi

##
# Unclutter
# Hides the mouse when typing and idling
##
if ! hash unclutter 2>/dev/null ; then
    echo "Installing unclutter"
    sudo apt-get install unclutter -y
fi

##
# Awesome!
##
if ! hash awesome 2>/dev/null ; then
    echo "Installing awesomewm"
    sudo add-apt-repository ppa:klaus-vormweg/awesome
    sudo apt-get update

    sudo apt-get install awesome awesome-extra
fi

##
# Terminator, the terminal I prefer
##
if ! hash terminator 2>/dev/null ; then
    echo "Installing terminator"
    sudo apt-get install terminator
fi

##
# zsh
##
if ! hash zsh 2>/dev/null ; then
    echo "Installing zsh"
    sudo apt-get install zsh
    sudo chsh -s /usr/bin/zsh
fi

##
# oh-my-zsh
##
if [ ! -d "$HOME/.oh-my-zsh" ] ; then
    echo "Install oh-my-zsh"
    git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
fi

##
#  Synapse
#  quick launch tool
##
if ! hash synapse 2>/dev/null ; then
    echo "Installing synapse"
    sudo apt-get install synapse
fi

##
# Packer
# Tool to automate provisioning
##
if ! hash packer 2>/dev/null ; then
    echo "Installing packer"
    wget https://dl.bintray.com/mitchellh/packer/0.3.10_linux_amd64.zip
    sudo mkdir /usr/local/packer
    sudo unzip 0.3.10_linux_amd64.zip -d /usr/local/packer
fi

##
# redshift
# Tool to save my eyes
##
if ! hash redshift 2>/dev/null ; then
    echo "Installing redshift"
    sudo apt-get install redshift
fi

if ! hash disper 2>/dev/null ; then
    echo "Installing disper"
    wget http://ppa.launchpad.net/disper-dev/ppa/ubuntu/pool/main/d/disper/disper_0.3.1.tar.gz
    tar -xzf disper_0.3.1.tar.gz
    rm disper_0.3.1.tar.gz
fi

if ! hash spotify 2>/dev/null ; then
    echo "Installing spotify"
    echo "deb http://repository.spotify.com stable non-free" | sudo tee /etc/apt/sources.list.d/spotify.list
    sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 94558F59
    sudo apt-get update
    sudo apt-get install spotify-client
fi

if ! hash dropbox 2>/dev/null ; then
    echo "Installing dropbox"
    wget -O dropbox_1.6.0_amd64.deb https://www.dropbox.com/download?dl=packages/ubuntu/dropbox_1.6.0_amd64.deb
    sudo dpkg -i dropbox_1.6.0_amd64.deb
    rm dropbox_1.6.0_amd64.deb
    mkdir $HOME/Dropbox

    dropbox start -i
fi
